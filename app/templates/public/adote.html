{% extends "base.html" %}
{% block content %}

<section class="adopt-page">
  <div class="page-wrap adopt-wrap">

    <!-- Cabe√ßalho -->
    <header class="adopt-head">
      <h1>Quero adotar üêæ</h1>
      <p class="muted">
        Ado√ß√£o respons√°vel muda vidas. Preencha o formul√°rio ou clique em ‚ÄúAdotar‚Äù em um animal para falar com a ONG pelo WhatsApp.
      </p>

      <div class="adopt-cta">
        <a class="btn" href="#lista">Ver animais</a>
        <a class="btn btn--ghost" href="#form">Formul√°rio de ado√ß√£o</a>
      </div>
    </header>

    <!-- Checklist -->
    <div class="card adopt-checklist">
      <h2>Checklist de ado√ß√£o respons√°vel ‚úÖ</h2>
      <ul>
        {% for item in checklist %}
          <li>{{ item }}</li>
        {% endfor %}
      </ul>

      <div class="muted" style="margin-top:10px;">
        Se voc√™ concorda com esses pontos, voc√™ j√° est√° no caminho certo üíõ
      </div>
    </div>

    <!-- Lista de animais -->
    <section id="lista" class="adopt-list">
      <div class="card card--soft" style="margin-bottom:14px;">
        <h2>Animais dispon√≠veis</h2>
        <p class="muted">
          Alguns dos animais acolhidos pelo Lar da Regina. Em breve isso ser√° autom√°tico pelo sistema.
        </p>
      </div>

      <div class="adopt-layout">
        <!-- SIDEBAR / FILTROS -->
        <aside class="card adopt-filters">
          <div class="filters__header">
            <strong>Filtros</strong>
            <button class="filters__clear" type="button" id="clearFilters">Limpar</button>
          </div>

          <div class="search">
            <span>Buscar por nome</span>
            <input id="filterName" type="text" placeholder="Ex: Jade, Mel...">
          </div>

          <div class="filter-block">
            <h3>Status</h3>
            <label><input type="checkbox" value="Para ado√ß√£o" class="filterStatus"> Para ado√ß√£o</label>
            <label><input type="checkbox" value="Em tratamento" class="filterStatus"> Em tratamento</label>
            <label><input type="checkbox" value="Resgatada" class="filterStatus"> Resgatada</label>
          </div>

          <div class="filter-block">
            <h3>Tipo</h3>
            <label><input type="checkbox" value="C√£o" class="filterTipo"> C√£es</label>
            <label><input type="checkbox" value="Gato" class="filterTipo"> Gatos</label>
          </div>
        </aside>

        <!-- GRID DE CARDS -->
        <div class="adopt-grid" id="adoptGrid">
          {% for a in animais %}
            <article class="card adopt-card"
                    data-nome="{{ a.nome|lower }}"
                    data-status="{{ a.status }}"
                    data-tipo="{{ a.tipo }}">
              <img class="adopt-card__img"
                  src="{{ url_for('static', filename=a.foto) }}"
                  alt="{{ a.nome }}">

              <div class="adopt-card__body">
                <div class="adopt-card__top">
                  <div>
                    <h3 class="adopt-card__title">{{ a.nome }}</h3>
                    <div class="adopt-card__meta">{{ a.tipo }}</div>
                  </div>
                  <span class="tag">{{ a.status }}</span>
                </div>

                <p class="muted adopt-card__hint">
                  Para adotar, clique em ‚ÄúAdotar‚Äù e fale com a ONG no WhatsApp.
                </p>

                <div class="adopt-card__actions">
                  <button class="btn btn--small"
                          type="button"
                          data-adotar
                          data-nome="{{ a.nome }}"
                          data-status="{{ a.status }}">
                    Adotar {{ a.nome }}
                  </button>

                  <a class="btn btn--ghost btn--small"
                    href="{{ url_for('public.apadrinhamento_lista') }}">
                    Apadrinhar
                  </a>
                </div>
              </div>
            </article>
          {% endfor %}
        </div>
      </div>
    </section>


    <!-- Formul√°rio geral -->
    <section id="form" class="card adopt-form">
      <div class="adopt-form__head">
        <h2>Formul√°rio de ado√ß√£o</h2>
        <p class="muted">Preencha e clique em ‚ÄúEnviar no WhatsApp‚Äù. A mensagem vai pronta.</p>
      </div>

      <form class="adopt-form__grid" onsubmit="return false;">
        <div class="field">
          <label for="adName">Seu nome</label>
          <input id="adName" type="text" placeholder="Ex: Maria Silva">
        </div>

        <div class="field">
          <label for="adAnimal">Voc√™ quer adotar qual animal? <span class="muted">(opcional)</span></label>
          <input id="adAnimal" type="text" placeholder="Ex: Jade">
        </div>

        <div class="field">
          <label for="adCity">Cidade / Bairro</label>
          <input id="adCity" type="text" placeholder="Ex: Guarulhos - Centro">
        </div>

        <div class="field">
          <label for="adHome">Voc√™ mora em‚Ä¶</label>
          <input id="adHome" type="text" placeholder="Ex: casa / apartamento (com telas?)">
        </div>

        <div class="field field--full">
          <label for="adMsg">Mensagem <span class="muted">(opcional)</span></label>
          <textarea id="adMsg" rows="5" placeholder="Conte um pouco sobre sua rotina e por que quer adotar."></textarea>
          <small class="helper">Dica: informe se tem outros animais e se a casa √© telada (no caso de gatos).</small>
        </div>

        <div class="adopt-form__actions">
          <a class="btn" id="btnAdoptWhats" target="_blank" rel="noopener">
            Enviar no WhatsApp
          </a>
          <a class="btn btn--ghost" href="{{ url_for('public.doacao') }}">
            Quero ajudar com doa√ß√£o
          </a>
        </div>
      </form>
    </section>


  </div>
</section>

<script>
  const wpp = "{{ ong.whatsapp }}";

  // Bot√µes "Adotar [nome]" dos cards
  document.querySelectorAll("[data-adotar]").forEach(btn => {
    btn.addEventListener("click", () => {
      const nome = btn.getAttribute("data-nome");
      const status = btn.getAttribute("data-status");
      const text = encodeURIComponent(
        `Ol√°! Tenho interesse em adotar o(a) ${nome} (${status}). ` +
        `Podem me orientar sobre o processo de ado√ß√£o?`
      );
      window.open(`https://wa.me/${wpp}?text=${text}`, "_blank");
    });
  });

  // Formul√°rio geral -> WhatsApp
  const name = document.getElementById("adName");
  const animal = document.getElementById("adAnimal");
  const city = document.getElementById("adCity");
  const home = document.getElementById("adHome");
  const msg = document.getElementById("adMsg");
  const btnWpp = document.getElementById("btnAdoptWhats");

  function buildMsg(){
    const n = name.value.trim() || "Ol√°";
    const a = animal.value.trim();
    const c = city.value.trim() || "(n√£o informado)";
    const h = home.value.trim() || "(n√£o informado)";
    const m = msg.value.trim();

    let text = `Ol√°! Meu nome √© ${n} e quero adotar.`;
    if (a) text += ` Tenho interesse no(a) ${a}.`;
    text += `\nCidade/Bairro: ${c}`;
    text += `\nMoradia: ${h}`;
    if (m) text += `\nMensagem: ${m}`;
    text += `\n\nPodem me orientar sobre os pr√≥ximos passos?`;

    return encodeURIComponent(text);
  }

  function updateLink(){
    btnWpp.href = `https://wa.me/${wpp}?text=${buildMsg()}`;
  }

  [name, animal, city, home, msg].forEach(el => el.addEventListener("input", updateLink));
  updateLink();
</script>

{% endblock %}
